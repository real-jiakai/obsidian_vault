#操作系统 #软链接

# 软链接实验

&emsp;&emsp;在进行操作系统实验八软链接的相关实验的时候，发现源文件或目录，以及目标文件或目录，两者只要有其一不在当前路径下，最后用ls -l命令查看创建软链接的文件，终端就会显示红色。在网上查找资料后，发现了这样的解答，用`ln -s`命令创建软链接，需要全部使用绝对路径。按照这思路实验，确实解决了我的问题，但是前后均需使用绝对路径引起了我的怀疑。

<!--more-->

## 1.场景还原

下面先来复盘一下一开始创建软链接，终端显示红色的场景。

![image-20211219083439103]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190834181.png)

<div align="center">图一：源文件在当前路径下，创建软链接的目标文件也在当前路径下</div>

首先用`cp`命令复制了一份fun文件的副本，取名为fun2；接着用`ln -s`命令来创建软链接，使得fun2-sym1文件指向fun2文件文件名；接着我们用`ls -l`命令查看fun2文件的软链接—fun2-sym1文件的详细信息。可以看到终端颜色为青色，这表明软链接状态正常，即fun2-sym1文件能正确指向fun2文件的文件名。

***

对于软链接的颜色的规定，我在StackExchange网站上，发现了一位网友的详解。

![image-20211219084900153]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190849208.png)

<div align="center">图二：What do the different colors mean in ls?</div>

其中，我们重点关注红框框出来的部分。

+ 青色(天蓝色)：软链接文件
+ 底色是黑色，文件名是红色：破损的链接【死的软链接/dead symlink】

当然一开始，我并没有去搜索关于软链接颜色相关的资料，我是在按照模板进行完软链接实验的时候，发现颜色有红色、有青色，颜色的不一致引起了我的怀疑。

***

![image-20211219085953625]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190859695.png)

<div align="center">图三：源文件在当前路径下，目标文件在当前路径下的一个文件夹下</div>

可以看到终端此时出现了红色，这说明创建出的软链接是死的(dead symlink)。



## 2.绝对路径创建软链接

![image-20211219090403267]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190904337.png)

<div align="center">图四：源文件和目标文件均采用绝对路径</div>

采用绝对路径后，终端软链接文件的颜色为青色，这说明软链接状态正常。



## 3.源文件、目标文件必须使用绝对路径吗？

![image-20211219090739854]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190907929.png)

<div align="center">图五：源文件是当前路径，目标文件采用绝对路径</div>

采用此法，创建出来的是一个死的软链接。

![image-20211219091002697]( https://cdn.gujiakai.top/image/pic-go-typora02/img/202112190910771.png)

<div align="center">图六：源文件是绝对路径，目标文件采用相对路径</div>

成功创建软链接。

写到这，我自己脑袋里面都晕晕的。就以下表作为上述实验的总结。

<div align="center" style="color:red;font-size:20px;">成功创建文件软链接的汇总表</div>

|            源文件位置            | 目标文件位置                                 | 状态 |
| :------------------------------: | -------------------------------------------- | ---- |
| 当前路径(绝对路径和相对路径均可) | 当前路径(绝对路径和相对路径均可)             | 正常 |
|    当前路径(必须采用绝对路径)    | 当前路径下的文件夹下(绝对路径和相对路径均可) | 正常 |



## 4.小结

因此保险起见，创建软链接时，源文件和目标文件均采用绝对路径的方式给出，这样子创建出来的软链接一定是正常的。

## 5.参考链接

[理解inode](https://www.ruanyifeng.com/blog/2011/12/inode.html)

[What do the different colors mean in ls?](https://askubuntu.com/questions/17299/what-do-the-different-colors-mean-in-ls)
